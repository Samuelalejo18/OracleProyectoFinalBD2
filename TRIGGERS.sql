CREATE TABLE factura (
 num_fac varchar(12)PRIMARY KEY,
 fec_fac date,
 cod_cli char(5),
 fec_can date,
 est_fac varchar(10),
 cod_ven char(3),
 por_igv decimal(18, 0)
);

create table producto (
 cod_pro char(4) primary key,
 des_pro VARCHAR(50),
 pre_pro DECIMAL (10,2),
 sac_pro int ,
 sme_pro int,
 uni_pro VARCHAR(30),
 lin_pro varchar(30),
 imp_pro varchar(10)
);


CREATE TABLE detalle_factura (
 num_fac varchar(12),
 cod_pro char(4),
 can_ven int,
 pre_ven float
);

alter table detalle_factura
add primary key(num_fac,cod_pro);

alter table detalle_factura
add constraint fk_num_facP
FOREIGN key (num_fac) REFERENCES factura(num_fac)ON DELETE CASCADE;

alter table detalle_factura
add constraint fk_cod_pro_df foreign key (cod_pro) references producto(cod_pro)ON DELETE CASCADE;



create table vendedor(
 cod_ven char(3) primary key,
 nom_ven varchar(20),
 ape_ven varchar(20),
 sue_ven float,
 fin_ven date,
 tip_ven varchar(10),
 cod_dis char(5)
);

create table distrito(
 cod_dis char(5) primary key,
 nom_dis varchar(50)
);


create table proveedor(
cod_prv char(5)PRIMARY KEY,
rso_prv varchar(80),
dir_prv varchar(100),
tel_prv char(15),
cod_dis char(5),
rep_pro varchar(80)
);


CREATE TABLE cliente (
 cod_cli char(5) PRIMARY KEY,
 rso_cli char(30),
 dir_cli varchar(100),
 tlf_cli char(9),
 ruc_cli char(11),
 cod_dis char(5),
 fec_reg date,
 tip_cli varchar(10),
 con_cli varchar(30)
);


ALTER TABLE cliente MODIFY (cod_cli CHAR(4));
ALTER TABLE factura MODIFY (cod_cli CHAR(4));



ALTER TABLE factura
ADD CONSTRAINT fk_cod_cli_fa foreign key(cod_cli) references cliente(cod_cli) ON DELETE CASCADE;
ALTER TABLE factura
ADD CONSTRAINT fk_cod_ven_fa foreign key(cod_ven) references vendedor(cod_ven) ON DELETE CASCADE;

ALTER TABLE vendedor
ADD CONSTRAINT fk_cod_dis_v FOREIGN KEY (cod_dis) REFERENCES distrito(cod_dis) ON DELETE CASCADE;
ALTER TABLE cliente
ADD CONSTRAINT fk_cod_dis_c FOREIGN KEY (cod_dis) REFERENCES distrito(cod_dis) ON DELETE CASCADE;
ALTER TABLE proveedor
ADD CONSTRAINT fk_cod_dis_p FOREIGN KEY (cod_dis) REFERENCES distrito(cod_dis) ON DELETE CASCADE;


create table abastecimiento (
 cod_prv char(5), /* provedor */
 cod_pro char(4), /*producto*/
 pre_aba DECIMAL(10,2)
);


ALTER TABLE abastecimiento ADD PRIMARY KEY (cod_prv, cod_pro);
ALTER TABLE abastecimiento
ADD CONSTRAINT fk_cod_prv FOREIGN KEY (cod_prv) REFERENCES proveedor(cod_prv) ON DELETE CASCADE;
ALTER TABLE abastecimiento
ADD CONSTRAINT fk_cod_pro FOREIGN KEY (cod_pro) REFERENCES producto(cod_pro) ON DELETE CASCADE;

create table detalle_compra (
 num_oco char(5), /* orden_compra*/
 cod_pro char(4), /*producto*/
 can_det int
);



create table orden_compra (
 num_oco char(5) PRIMARY KEY ,
 fec_oco DATE,
 cod_prv char(5),
 fat_oco date,
 est_oco char(1)
);
ALTER TABLE orden_compra
ADD CONSTRAINT fk_orden_compra_c FOREIGN KEY (cod_prv) REFERENCES proveedor(cod_prv) ON DELETE
CASCADE;


ALTER TABLE detalle_compra ADD PRIMARY KEY (num_oco,cod_pro);
ALTER TABLE detalle_compra
ADD CONSTRAINT fk_num_oco_dc FOREIGN KEY (num_oco) REFERENCES orden_compra(num_oco) ON
DELETE CASCADE;
ALTER TABLE detalle_compra
ADD CONSTRAINT fk_cod_pro_dc FOREIGN KEY (cod_pro) REFERENCES producto(cod_pro) ON DELETE
CASCADE;


CREATE TABLE auditoria (
    id_audit NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nombre_tabla VARCHAR2(50),
    tipo_operacion VARCHAR2(10),
    usuario_bdd VARCHAR2(50),
    fecha_operacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    detalle CLOB
);



INSERT INTO DISTRITO VALUES('D01','SURCO');
INSERT INTO DISTRITO VALUES('D02','JESUS MARIA');
INSERT INTO DISTRITO VALUES('D03','SAN ISIDRO');
INSERT INTO DISTRITO VALUES('D04','LA MOLINA');
INSERT INTO DISTRITO VALUES('D05','SAN MIGUEL');
INSERT INTO DISTRITO VALUES('D06','MIRAFLORES');
INSERT INTO DISTRITO VALUES('D07','BARRANCO');
INSERT INTO DISTRITO VALUES('D08','CHORRILLOS');
INSERT INTO DISTRITO VALUES('D09','SAN BORJA');
INSERT INTO DISTRITO VALUES('D10','LINCE');
INSERT INTO DISTRITO VALUES('D11','BRE�A');
INSERT INTO DISTRITO VALUES('D12','MAGDALENA');
INSERT INTO DISTRITO VALUES('D13','RIMAC');
INSERT INTO DISTRITO VALUES('D14','SURQUILLO');
INSERT INTO DISTRITO VALUES('D15','PUEBLO LIBRE');
INSERT INTO DISTRITO VALUES('D16','BELLAVISTA');
INSERT INTO DISTRITO VALUES('D17','CALLAO');
INSERT INTO DISTRITO VALUES('D18','SAN MARTIN DE PORRES');
INSERT INTO DISTRITO VALUES('D19','SANTA ANITA');
INSERT INTO DISTRITO VALUES('D20','LOS OLIVOS');
INSERT INTO DISTRITO VALUES('D21','INDEPENDENCIA');
INSERT INTO DISTRITO VALUES('D22','LIMA - CERCADO');
INSERT INTO DISTRITO VALUES('D24','SAN LUIS');
INSERT INTO DISTRITO VALUES('D25','EL AGUSTINO');
INSERT INTO DISTRITO VALUES('D26','SAN JUAN DE LURIGANCHO');
INSERT INTO DISTRITO VALUES('D27','ATE - VITARTE');
INSERT INTO DISTRITO VALUES('D28','SAN JUAN DE MIRAFLORES');
INSERT INTO DISTRITO VALUES('D29','CARMEN DE LA LEGUA');
INSERT INTO DISTRITO VALUES('D30','COMAS');
INSERT INTO DISTRITO VALUES('D31','VILLA MARIA DEL TRIUNFO');
INSERT INTO DISTRITO VALUES('D32','VILLA EL SALVADOR');
INSERT INTO DISTRITO VALUES('D33','LA PERLA');
INSERT INTO DISTRITO VALUES('D34','VENTANILLA');
INSERT INTO DISTRITO VALUES('D35','PUENTE PIEDRA');
INSERT INTO DISTRITO VALUES('D36','CARABAYLLO');
INSERT INTO DISTRITO VALUES('D37','SANTA MARIA');



INSERT INTO VENDEDOR VALUES('V01','JUANA','ALVA',1000,TO_DATE('07/12/2003','DD-MM-YYYY'),'1','D08');
INSERT INTO VENDEDOR VALUES('V02','JUAN','SOTO',1200,TO_DATE('10/03/2002','DD/MM/YYYY'),'2','D03');
INSERT INTO VENDEDOR
VALUES('V03','CARLOS','AREVALO',1500,TO_DATE('02/10/1992','DD/MM/YYYY'),'2','D09');
INSERT INTO VENDEDOR VALUES('V04','CESAR','OJEDA',850,TO_DATE('08/11/1999','DD/MM/YYYY'),'1','D01');
INSERT INTO VENDEDOR VALUES('V05','JULIO','VEGA',1500,TO_DATE('11/05/1997','DD/MM/YYYY'),'1','D01');
INSERT INTO VENDEDOR VALUES('V06','ANA','ORTEGA',1200,TO_DATE('11/05/1994','DD/MM/YYYY'),'1','D05');
INSERT INTO VENDEDOR
VALUES('V07','JOSE','PALACIOS',2500,TO_DATE('12/02/1997','DD/MM/YYYY'),'1','D02');
INSERT INTO VENDEDOR
VALUES('V08','RUBEN','GOMEZ',1450,TO_DATE('12/08/1996','DD/MM/YYYY'),'2','D04');
INSERT INTO VENDEDOR
VALUES('V09','PATRICIA','ARCE',1800,TO_DATE('12/05/1997','DD/MM/YYYY'),'2','D04');
INSERT INTO VENDEDOR
VALUES('V10','RENATO','PEREZ',1550,TO_DATE('11/08/1998','DD/MM/YYYY'),'2','D01');




INSERT INTO CLIENTE VALUES('C001','FINSETH','AV. LOS VIÑEDOS
150','4342318','48632081','D05',TO_DATE('12/10/2008','DD/MM/YYYY'),'1','ALICIA BARRETO');
INSERT INTO CLIENTE VALUES('C002','ORBI','AV. EMILIO CAVENECIA
225','4406335','57031642','D04',TO_DATE('02/01/2013','DD/MM/YYYY'),'2','ALFONSO BELTRAN');
INSERT INTO CLIENTE VALUES('C003','SERVIEMSA','JR. COLLAGATE
522','75012403',NULL,'D05',TO_DATE('06/03/2011','DD/MM/YYYY'),'2','CHRISTIAN LAGUNA');
INSERT INTO CLIENTE VALUES('C004','ISSA','CALLE LOS AVIADORES
263','3725910','46720159','D01',TO_DATE('09/12/2012','DD/MM/YYYY'),'1','LUIS APUMAYTA');
INSERT INTO CLIENTE VALUES('C005','MASS','AV. TOMAS MARSANO
880','4446177','83175942','D14',TO_DATE('10/01/2013','DD/MM/YYYY'),'1','KATIA ARMEJO');
INSERT INTO CLIENTE VALUES('C006','BERKER','AV. LOS PROCERES
521','3810322','54890124','D05',TO_DATE('07/05/2013','DD/MM/YYYY'),'1','JUDITH ASTE');
INSERT INTO CLIENTE VALUES('C007','FIDENZA','JR. EL NIQUEL
282','5289034','16204790','D20',TO_DATE('10/02/2012','DD/MM/YYYY'),'2','HECTOR VIVANCO');
INSERT INTO CLIENTE VALUES('C008','INTECH','AV. SAN LUIS 2619 5TO
P','2249493','34021824','D09',TO_DATE('01/07/2011','DD/MM/YYYY'),'2','CARLOS VILLANUEVA');
INSERT INTO CLIENTE VALUES('C009','PROMINENT','JR. IQUIQUE
132','43233519',NULL,'D11',TO_DATE('06/11/2010','DD/MM/YYYY'),'1','JORGE VALDIVIA');
INSERT INTO CLIENTE VALUES('C010','LANDU','AV.NICOLAS DE AYLLON
1453','3267840','30405261','D05',TO_DATE('11/06/2013','DD/MM/YYYY'),'2','RAQUEL ESPINOZA');
INSERT INTO CLIENTE VALUES('C011','FILASUR','AV. EL SANTUARIO
1189','4598175','70345201','D26',TO_DATE('08/04/2012','DD/MM/YYYY'),'1','ANGELICA VIVAS');
INSERT INTO CLIENTE VALUES('C012','SUCERTE','JR. GRITO DE HUAURA
114','4206434','62014503','D05',TO_DATE('11/08/2011','DD/MM/YYYY'),'1','KARINA VEGA');
INSERT INTO CLIENTE VALUES('C013','HAYASHI','JR. AYACUCHO
359','42847990',NULL,'D22',TO_DATE('03/09/2013','DD/MM/YYYY'),'2','ERNESTO UEHARA');
INSERT INTO CLIENTE VALUES('C014','KADIA','AV.SANTA CRUZ 1332
OF.201','4412418','22202915','D06',TO_DATE('10/05/2011','DD/MM/YYYY'),'1','MIGUEL ARCE');
INSERT INTO CLIENTE VALUES('C015','MEBA','AV. ELMER FAUCETT
1638','4641234','50319542','D16',TO_DATE('06/11/2011','DD/MM/YYYY'),'2','RICARDO GOMEZ');
INSERT INTO CLIENTE VALUES('C016','CARDELI','JR. BARTOLOME HERRERA
451','2658853','26403158','D10',TO_DATE('05/04/2013','DD/MM/YYYY'),'2','GIANCARLO BONIFAZ');
INSERT INTO CLIENTE VALUES('C017','PAYET','CALLE JUAN FANNING
327','4779834','70594032','D07',TO_DATE('05/12/2013','DD/MM/YYYY'),'1','PAOLA URIBE');
INSERT INTO CLIENTE VALUES('C018','DASIN','AV. SAENZ PEÑA 338 -
B','4657574','35016752','D17',TO_DATE('12/03/2011','DD/MM/YYYY'),'1','ANGELA BARRETO');
INSERT INTO CLIENTE VALUES('C019','COREFO','AV. CANADA 3894 -
3898','4377499','57201691','D24',TO_DATE('01/03/2010','DD/MM/YYYY'),'2','ROSALYN CORTEZ');
INSERT INTO CLIENTE VALUES('C020','CRAMER','JR. MARISCAL MILLER
1131','4719061','46031783','D02',TO_DATE('08/11/2010','DD/MM/YYYY'),'1','CHRISTOPHER RAMOS');



INSERT INTO PROVEEDOR VALUES('PR01','FABER CASTELL','AV. ISABEL LA CATOLICA
1875','4330895','D13','CARLOS AGUIRRE');
INSERT INTO PROVEEDOR VALUES('PR02','ATLAS','AV. LIMA 471','5380926','D13','CESAR TORRES');
INSERT INTO PROVEEDOR VALUES('PR03','3M','AV. VENEZUELA 3018','2908165','D16','OMAR INJOQUE');
INSERT INTO PROVEEDOR VALUES('PR04','DITO','AV. METROPOLITANA 376',NULL,'D19','RAMON FLORES');
INSERT INTO PROVEEDOR VALUES('PR05','ACKER','CALLE LAS DUNAS 245','4780143','D27','JULIO ACU A');
INSERT INTO PROVEEDOR VALUES('PR06','DEDITEC','CALLE PICHINCHA 644','5662848','D11','JAVIER
GONZALES');
INSERT INTO PROVEEDOR VALUES('PR07','OFFICETEC','CALLE LAS PERDICES 225 OF.
204','4216184','D03','CARLOS ROBLES');
INSERT INTO PROVEEDOR VALUES('PR08','INVICTA','AV. LOS FRUTALES 564','4364247','D27','ALBERTO
RODRIGUEZ');
INSERT INTO PROVEEDOR VALUES('PR09','DIPROPOR','AV. DEL AIRE 901','4742046','D24','ROBERTO
RONCEROS');
INSERT INTO PROVEEDOR VALUES('PR10','MIURA','AV. LA PAZ 257','4459710','D06','JORGE VASQUEZ');
INSERT INTO PROVEEDOR VALUES('PR11','PRAXIS','AV. JOSE GALVEZ 1820 - 1844','4703944','D10','ERICKA
ZEGARRA');
INSERT INTO PROVEEDOR VALUES('PR12','SUMIGRAF','AV. MANCO CAPAC 754','3320343','D13','KARINNA
PAREDES');
INSERT INTO PROVEEDOR VALUES('PR13','LIMMSA','PROLG. HUAYLAS 670','2546995','D08','LAURA ORTEGA');
INSERT INTO PROVEEDOR VALUES('PR14','VENINSA','AV. TEJADA 338','2473832','D07','MELISA RAMOS');
INSERT INTO PROVEEDOR VALUES('PR15','CROSLAND','AV. ARGENTINA 3206 - 3250','4515272','D17','JUAN
RAMIREZ');
INSERT INTO PROVEEDOR VALUES('PR16','PETRAMAS','CALLE JOAQUIN MADRID 141 2DO P',NULL,'D09','ROCIO
GUERRERO');
INSERT INTO PROVEEDOR VALUES('PR17','REAWSE','AV. SANTA ROSA 480 ',NULL,'D19','MARIA PEREZ');
INSERT INTO PROVEEDOR VALUES('PR18','EDUSA','AV. MORALES DUAREZ 1260','4525536','D29','PABLO
MARTEL');
INSERT INTO PROVEEDOR VALUES('PR19','OTTMER','URB.PRO INDUSTRIAL MZ B6 LT
16','5369893','D18','ANGELA RENDILLA');
INSERT INTO PROVEEDOR VALUES('PR20','BARI','AV. ARNALDO MARQUEZ 1219',NULL,'D02','VANESA
QUINTANA');



INSERT INTO FACTURA VALUES('FA001', TO_DATE('2013-07-06', 'YYYY-MM-DD'), 'C001', TO_DATE('2013-08-
05', 'YYYY-MM-DD'), '2', 'V01', 0.19);
INSERT INTO FACTURA VALUES('FA002', TO_DATE('2013-07-06', 'YYYY-MM-DD'), 'C019', TO_DATE('2013-08-
05', 'YYYY-MM-DD'), '3', 'V02', 0.19);
INSERT INTO FACTURA VALUES('FA003', TO_DATE('2013-09-01', 'YYYY-MM-DD'), 'C003', TO_DATE('2013-10-
03', 'YYYY-MM-DD'), '2', 'V04', 0.19);
INSERT INTO FACTURA VALUES('FA004', TO_DATE('2013-09-06', 'YYYY-MM-DD'), 'C016', TO_DATE('2013-10-
05', 'YYYY-MM-DD'), '2', 'V07', 0.19);
INSERT INTO FACTURA VALUES('FA005', TO_DATE('2013-10-01', 'YYYY-MM-DD'), 'C015', TO_DATE('2013-10-
12', 'YYYY-MM-DD'), '2', 'V08', 0.19);
INSERT INTO FACTURA VALUES('FA006', TO_DATE('2013-08-01', 'YYYY-MM-DD'), 'C009', TO_DATE('2013-08-
05', 'YYYY-MM-DD'), '3', 'V05', 0.19);
INSERT INTO FACTURA VALUES('FA007', TO_DATE('2013-10-05', 'YYYY-MM-DD'), 'C019', TO_DATE('2013-10-
10', 'YYYY-MM-DD'), '1', 'V09', 0.19);
INSERT INTO FACTURA VALUES('FA008', TO_DATE('2013-10-04', 'YYYY-MM-DD'), 'C012', TO_DATE('2013-10-
06', 'YYYY-MM-DD'), '2', 'V10', 0.19);
INSERT INTO FACTURA VALUES('FA009', TO_DATE('2013-10-03', 'YYYY-MM-DD'), 'C008', TO_DATE('2013-10-
10', 'YYYY-MM-DD'), '2', 'V09', 0.19);
INSERT INTO FACTURA VALUES('FA010', TO_DATE('2013-10-01', 'YYYY-MM-DD'), 'C017', TO_DATE('2013-10-
06', 'YYYY-MM-DD'), '2', 'V02', 0.19);
INSERT INTO FACTURA VALUES('FA011', TO_DATE('2013-09-10', 'YYYY-MM-DD'), 'C019', TO_DATE('2013-09-
10', 'YYYY-MM-DD'), '2', 'V05', 0.19);
INSERT INTO FACTURA VALUES('FA012', TO_DATE('2013-12-01', 'YYYY-MM-DD'), 'C014', TO_DATE('2013-12-
01', 'YYYY-MM-DD'), '1', 'V04', 0.19);
INSERT INTO FACTURA VALUES('FA013', TO_DATE('2013-12-01', 'YYYY-MM-DD'), 'C011', TO_DATE('2013-12-
01', 'YYYY-MM-DD'), '3', 'V08', 0.19);
INSERT INTO FACTURA VALUES('FA014', TO_DATE('2012-12-01', 'YYYY-MM-DD'), 'C020', TO_DATE('2013-12-
01', 'YYYY-MM-DD'), '2', 'V09', 0.19);
INSERT INTO FACTURA VALUES('FA015', TO_DATE('2012-12-08', 'YYYY-MM-DD'), 'C015', TO_DATE('2013-01-
06', 'YYYY-MM-DD'), '2', 'V07', 0.19);
INSERT INTO FACTURA VALUES('FA016', TO_DATE('2013-01-06', 'YYYY-MM-DD'), 'C016', TO_DATE('2013-01-
09', 'YYYY-MM-DD'), '2', 'V05', 0.19);
INSERT INTO FACTURA VALUES('FA017', TO_DATE('2013-01-06', 'YYYY-MM-DD'), 'C015', TO_DATE('2013-01-
06', 'YYYY-MM-DD'), '1', 'V06', 0.19);
INSERT INTO FACTURA VALUES('FA018', TO_DATE('2013-02-03', 'YYYY-MM-DD'), 'C016', TO_DATE('2013-02-
04', 'YYYY-MM-DD'), '2', 'V10', 0.19);
INSERT INTO FACTURA VALUES('FA019', TO_DATE('2013-02-07', 'YYYY-MM-DD'), 'C008', TO_DATE('2013-03-
01', 'YYYY-MM-DD'), '2', 'V03', 0.19);
INSERT INTO FACTURA VALUES('FA020', TO_DATE('2013-02-06', 'YYYY-MM-DD'), 'C013', TO_DATE('2013-03-
10', 'YYYY-MM-DD'), '2', 'V02', 0.19);




INSERT INTO PRODUCTO VALUES('P001','PAPEL BOND A-4',35.0, 200,1500,'MLL','2','V');
INSERT INTO PRODUCTO VALUES('P002','PAPEL BOND OFICIO ',35, 50,1500,'MLL','2','F');
INSERT INTO PRODUCTO VALUES('P003','PAPEL BULKY ',10 ,498,1000,'MLL','2','V');
INSERT INTO PRODUCTO VALUES('P004','PAPEL PERIODICO',9,4285,1000,'MLL','2','F');
INSERT INTO PRODUCTO VALUES('P005','CARTUCHO TINTA NEGRA', 40 ,50,30,'UNI','1','F');
INSERT INTO PRODUCTO VALUES('P006','CARTUCHO TINTA COLOR ',45 ,58,35, 'UNI','1','F');
INSERT INTO PRODUCTO VALUES('P007','PORTA DISKETTES',3.5,300,100,'UNI','1','V');
INSERT INTO PRODUCTO VALUES('P008','CAJA DE DISKETTES * 10 ',30,125,180,'UNI','1','F');
INSERT INTO PRODUCTO VALUES('P009','BORRADOR DE TINTA ',10 ,100,500,'DOC','3','F');
INSERT INTO PRODUCTO VALUES('P010','BORRADOR BLANCO ',8 ,2000,400,'DOC','3','F');
INSERT INTO PRODUCTO VALUES('P011','TAJADOR METAL ',20 ,1120,300,'DOC','3','F');
INSERT INTO PRODUCTO VALUES('P012','TAJADOR PLASTICO',12 ,608,300,'DOC','3','F');
INSERT INTO PRODUCTO VALUES('P013','FOLDER MANILA OFICIO',20,200,150,'CIE','3','F');
INSERT INTO PRODUCTO VALUES('P014','FOLDER MANILA A-4',20 ,150,150,'CIE','3','V');
INSERT INTO PRODUCTO VALUES('P015','SOBRE MANILA OFICIO',15,300,130,'CIE','3','F');
INSERT INTO PRODUCTO VALUES('P016','SOBRE MANILA A-4',18,200,100,'CIE','3','F');
INSERT INTO PRODUCTO VALUES('P017','LAPICERO NEGRO',10,3000,1000,'DOC','3','F');
INSERT INTO PRODUCTO VALUES('P018','LAPICERO AZUL ',10 ,2013,1500,'DOC','3','F');
INSERT INTO PRODUCTO VALUES('P019','LAPICERO ROJO',8,1900,1000,'DOC','3','V');
INSERT INTO PRODUCTO VALUES('P020','FOLDER PLASTICO A-4',50 ,3080,1100,'CIE','3','F');
INSERT INTO PRODUCTO VALUES('P021','PROTECTOR DE PANTALLA',50,20,5,'UNI','1','F');


INSERT INTO ORDEN_COMPRA VALUES('OC001', TO_DATE('2013-03-05', 'YYYY-MM-DD'), 'PR08',
TO_DATE('2013-03-12', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC002', TO_DATE('2013-04-08', 'YYYY-MM-DD'), 'PR16',
TO_DATE('2013-04-10', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC003', TO_DATE('2013-08-02', 'YYYY-MM-DD'), 'PR10',
TO_DATE('2013-08-02', 'YYYY-MM-DD'), 3);
INSERT INTO ORDEN_COMPRA VALUES('OC004', TO_DATE('2013-04-05', 'YYYY-MM-DD'), 'PR01',
TO_DATE('2013-04-05', 'YYYY-MM-DD'), 3);
INSERT INTO ORDEN_COMPRA VALUES('OC005', TO_DATE('2013-03-06', 'YYYY-MM-DD'), 'PR07',
TO_DATE('2013-03-10', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC006', TO_DATE('2013-01-02', 'YYYY-MM-DD'), 'PR19',
TO_DATE('2013-01-02', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC007', TO_DATE('2013-02-06', 'YYYY-MM-DD'), 'PR20',
TO_DATE('2013-04-05', 'YYYY-MM-DD'), 3);
INSERT INTO ORDEN_COMPRA VALUES('OC008', TO_DATE('2013-06-02', 'YYYY-MM-DD'), 'PR04',
TO_DATE('2013-07-01', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC009', TO_DATE('2013-08-03', 'YYYY-MM-DD'), 'PR11',
TO_DATE('2013-09-10', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC010', TO_DATE('2013-09-05', 'YYYY-MM-DD'), 'PR01',
TO_DATE('2013-09-05', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC011', TO_DATE('2013-10-02', 'YYYY-MM-DD'), 'PR03',
TO_DATE('2013-10-03', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC012', TO_DATE('2013-10-04', 'YYYY-MM-DD'), 'PR14',
TO_DATE('2013-10-05', 'YYYY-MM-DD'), 3);
INSERT INTO ORDEN_COMPRA VALUES('OC013', TO_DATE('2013-11-02', 'YYYY-MM-DD'), 'PR05',
TO_DATE('2013-11-06', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC014', TO_DATE('2013-11-03', 'YYYY-MM-DD'), 'PR19',
TO_DATE('2013-12-05', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC015', TO_DATE('2013-11-03', 'YYYY-MM-DD'), 'PR18',
TO_DATE('2013-12-10', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC016', TO_DATE('2013-12-06', 'YYYY-MM-DD'), 'PR06',
TO_DATE('2013-12-06', 'YYYY-MM-DD'), 3);
INSERT INTO ORDEN_COMPRA VALUES('OC017', TO_DATE('2013-01-08', 'YYYY-MM-DD'), 'PR09',
TO_DATE('2013-01-08', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC018', TO_DATE('2013-02-01', 'YYYY-MM-DD'), 'PR20',
TO_DATE('2013-02-08', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC019', TO_DATE('2013-03-03', 'YYYY-MM-DD'), 'PR11',
TO_DATE('2013-03-06', 'YYYY-MM-DD'), 1);
INSERT INTO ORDEN_COMPRA VALUES('OC020', TO_DATE('2013-04-02', 'YYYY-MM-DD'), 'PR05',
TO_DATE('2013-04-02', 'YYYY-MM-DD'), 2);


INSERT INTO DETALLE_FACTURA VALUES('FA001','P007','6' ,'5');
INSERT INTO DETALLE_FACTURA VALUES('FA001','P011','25' ,'25');
INSERT INTO DETALLE_FACTURA VALUES('FA001','P013','11' ,'20');
INSERT INTO DETALLE_FACTURA VALUES('FA002','P004','8' ,'10');
INSERT INTO DETALLE_FACTURA VALUES('FA003','P002','10' ,'40');
INSERT INTO DETALLE_FACTURA VALUES('FA003','P011','6' ,'20');
INSERT INTO DETALLE_FACTURA VALUES('FA003','P017','21' ,'12');
INSERT INTO DETALLE_FACTURA VALUES('FA003','P019','12' ,'10');
INSERT INTO DETALLE_FACTURA VALUES('FA004','P004','3' ,'10');
INSERT INTO DETALLE_FACTURA VALUES('FA004','P009','50' ,'5');
INSERT INTO DETALLE_FACTURA VALUES('FA005','P003','20' ,'10');
INSERT INTO DETALLE_FACTURA VALUES('FA005','P006','50' ,'50');
INSERT INTO DETALLE_FACTURA VALUES('FA005','P020','5' ,'60');
INSERT INTO DETALLE_FACTURA VALUES('FA006','P002','20' ,'35');
INSERT INTO DETALLE_FACTURA VALUES('FA006','P003','15' ,'10');
INSERT INTO DETALLE_FACTURA VALUES('FA006','P009','12' ,'5');
INSERT INTO DETALLE_FACTURA VALUES('FA007','P003','20' ,'12');
INSERT INTO DETALLE_FACTURA VALUES('FA007','P012','4' ,'12');
INSERT INTO DETALLE_FACTURA VALUES('FA008','P004','15' ,'9');
INSERT INTO DETALLE_FACTURA VALUES('FA008','P008','15' ,'30');
INSERT INTO DETALLE_FACTURA VALUES('FA008','P020','50' ,'50');
INSERT INTO DETALLE_FACTURA VALUES('FA009','P001','5' ,'30');
INSERT INTO DETALLE_FACTURA VALUES('FA009','P002','15' ,'35');
INSERT INTO DETALLE_FACTURA VALUES('FA009','P006','2' ,'50');
INSERT INTO DETALLE_FACTURA VALUES('FA009','P019','1' ,'8');
INSERT INTO DETALLE_FACTURA VALUES('FA010','P002','3' ,'35');
INSERT INTO DETALLE_FACTURA VALUES('FA011','P002','20' ,'35');
INSERT INTO DETALLE_FACTURA VALUES('FA012','P002','3' ,'35');
INSERT INTO DETALLE_FACTURA VALUES('FA012','P006','1' ,'50');
INSERT INTO DETALLE_FACTURA VALUES('FA013','P002','130' ,'35');
INSERT INTO DETALLE_FACTURA VALUES('FA013','P003','5' ,'12');
INSERT INTO DETALLE_FACTURA VALUES('FA013','P015','4' ,'12');
INSERT INTO DETALLE_FACTURA VALUES('FA014','P009','10' ,'8');
INSERT INTO DETALLE_FACTURA VALUES('FA015','P008','5' ,'30');
INSERT INTO DETALLE_FACTURA VALUES('FA015','P016','3' ,'18');
INSERT INTO DETALLE_FACTURA VALUES('FA016','P006','15' ,'50');
INSERT INTO DETALLE_FACTURA VALUES('FA016','P008','2' ,'30');
INSERT INTO DETALLE_FACTURA VALUES('FA017','P002','120' ,'40');
INSERT INTO DETALLE_FACTURA VALUES('FA017','P005','120' ,'40');
INSERT INTO DETALLE_FACTURA VALUES('FA018','P003','4' ,'12');
INSERT INTO DETALLE_FACTURA VALUES('FA018','P005','6' ,'40');
INSERT INTO DETALLE_FACTURA VALUES('FA019','P002','150' ,'40');
INSERT INTO DETALLE_FACTURA VALUES('FA019','P003','6' ,'10');
INSERT INTO DETALLE_FACTURA VALUES('FA019','P006','2' ,'45');
INSERT INTO DETALLE_FACTURA VALUES('FA019','P008','10' ,'30');
INSERT INTO DETALLE_FACTURA VALUES('FA020','P009','120' ,'10');
INSERT INTO DETALLE_FACTURA VALUES('FA020','P015','5' ,'15');


INSERT INTO DETALLE_COMPRA VALUES('OC001','P006','100');
INSERT INTO DETALLE_COMPRA VALUES('OC001','P016','20');
INSERT INTO DETALLE_COMPRA VALUES('OC002','P003','200');
INSERT INTO DETALLE_COMPRA VALUES('OC002','P005','500');
INSERT INTO DETALLE_COMPRA VALUES('OC003','P005','50');
INSERT INTO DETALLE_COMPRA VALUES('OC004','P009','10');
INSERT INTO DETALLE_COMPRA VALUES('OC004','P013','50');
INSERT INTO DETALLE_COMPRA VALUES('OC005','P007','150');
INSERT INTO DETALLE_COMPRA VALUES('OC005','P008','100');
INSERT INTO DETALLE_COMPRA VALUES('OC008','P002','10');
INSERT INTO DETALLE_COMPRA VALUES('OC008','P012','100');
INSERT INTO DETALLE_COMPRA VALUES('OC009','P009','50');
INSERT INTO DETALLE_COMPRA VALUES('OC009','P011','50');
INSERT INTO DETALLE_COMPRA VALUES('OC010','P001','100');
INSERT INTO DETALLE_COMPRA VALUES('OC011','P016','10');
INSERT INTO DETALLE_COMPRA VALUES('OC011','P008','5');
INSERT INTO DETALLE_COMPRA VALUES('OC012','P011','100');
INSERT INTO DETALLE_COMPRA VALUES('OC012','P007','50');
INSERT INTO DETALLE_COMPRA VALUES('OC014','P004','50');
INSERT INTO DETALLE_COMPRA VALUES('OC013','P013','50');
INSERT INTO DETALLE_COMPRA VALUES('OC014','P020','50');
INSERT INTO DETALLE_COMPRA VALUES('OC014','P008','50');
INSERT INTO DETALLE_COMPRA VALUES('OC017','P012','100');
INSERT INTO DETALLE_COMPRA VALUES('OC016','P015','100');
INSERT INTO DETALLE_COMPRA VALUES('OC019','P006','100');
INSERT INTO DETALLE_COMPRA VALUES('OC017','P014','100');
INSERT INTO DETALLE_COMPRA VALUES('OC020','P011','100');
INSERT INTO DETALLE_COMPRA VALUES('OC020','P005','500');


INSERT INTO ABASTECIMIENTO VALUES('PR01','P003','8');
INSERT INTO ABASTECIMIENTO VALUES('PR01','P005','35');
INSERT INTO ABASTECIMIENTO VALUES('PR01','P007','3');
INSERT INTO ABASTECIMIENTO VALUES('PR01','P009','8');
INSERT INTO ABASTECIMIENTO VALUES('PR01','P011','18');
INSERT INTO ABASTECIMIENTO VALUES('PR02','P002','30');
INSERT INTO ABASTECIMIENTO VALUES('PR02','P007','3');
INSERT INTO ABASTECIMIENTO VALUES('PR03','P002','32');
INSERT INTO ABASTECIMIENTO VALUES('PR03','P004','7');
INSERT INTO ABASTECIMIENTO VALUES('PR04','P001','28');
INSERT INTO ABASTECIMIENTO VALUES('PR04','P006','40');
INSERT INTO ABASTECIMIENTO VALUES('PR05','P018','9');
INSERT INTO ABASTECIMIENTO VALUES('PR06','P009','7');
INSERT INTO ABASTECIMIENTO VALUES('PR06','P017','8');
INSERT INTO ABASTECIMIENTO VALUES('PR07','P016','15');
INSERT INTO ABASTECIMIENTO VALUES('PR07','P019','7');
INSERT INTO ABASTECIMIENTO VALUES('PR08','P006','42');
INSERT INTO ABASTECIMIENTO VALUES('PR08','P010','6');
INSERT INTO ABASTECIMIENTO VALUES('PR09','P002','30');
INSERT INTO ABASTECIMIENTO VALUES('PR09','P014','17');
INSERT INTO ABASTECIMIENTO VALUES('PR11','P001','27');
INSERT INTO ABASTECIMIENTO VALUES('PR11','P006','44');
INSERT INTO ABASTECIMIENTO VALUES('PR12','P002','33');
INSERT INTO ABASTECIMIENTO VALUES('PR12','P010','7');
INSERT INTO ABASTECIMIENTO VALUES('PR13','P005','35');
INSERT INTO ABASTECIMIENTO VALUES('PR14','P016','15');
INSERT INTO ABASTECIMIENTO VALUES('PR15','P020','45');
INSERT INTO ABASTECIMIENTO VALUES('PR16','P008','25');
INSERT INTO ABASTECIMIENTO VALUES('PR16','P012','9');
INSERT INTO ABASTECIMIENTO VALUES('PR16','P013','15');
INSERT INTO ABASTECIMIENTO VALUES('PR19','P008','28');
INSERT INTO ABASTECIMIENTO VALUES('PR19','P016','16');
INSERT INTO ABASTECIMIENTO VALUES('PR20','P012','10');
INSERT INTO ABASTECIMIENTO VALUES('PR20','P020','43');

CREATE TABLE auditoria (
    id_audit NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    nombre_tabla VARCHAR2(50),
    tipo_operacion VARCHAR2(10),
    usuario_bdd VARCHAR2(50),
    fecha_operacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    detalle CLOB
);




CREATE OR REPLACE TRIGGER trg_aud_factura
AFTER INSERT OR UPDATE OR DELETE ON factura
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar la operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: num_fac=' || :NEW.num_fac || ', cod_cli=' || :NEW.cod_cli || ', est_fac=' || :NEW.est_fac;
  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTERIOR: num_fac=' || :OLD.num_fac || ', est_fac=' || :OLD.est_fac ||
                 ' -> NUEVO: est_fac=' || :NEW.est_fac;
  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: num_fac=' || :OLD.num_fac || ', cod_cli=' || :OLD.cod_cli || ', est_fac=' || :OLD.est_fac;
  END IF;

  -- Insertar en auditoría
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('FACTURA', v_operacion, USER, v_detalle);
END;




CREATE OR REPLACE TRIGGER trg_aud_producto
AFTER INSERT OR UPDATE OR DELETE ON producto
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar tipo de operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: cod_pro=' || :NEW.cod_pro || ', des_pro=' || :NEW.des_pro || ', pre_pro=' || :NEW.pre_pro;
  
  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: cod_pro=' || :OLD.cod_pro || ', des_pro=' || :OLD.des_pro || ', pre_pro=' || :OLD.pre_pro ||
                 ' -> NUEVO: des_pro=' || :NEW.des_pro || ', pre_pro=' || :NEW.pre_pro;
  
  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: cod_pro=' || :OLD.cod_pro || ', des_pro=' || :OLD.des_pro || ', pre_pro=' || :OLD.pre_pro;
  END IF;

  -- Insertar en tabla auditoria
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('PRODUCTO', v_operacion, USER, v_detalle);
END;





CREATE OR REPLACE TRIGGER trg_aud_vendedor
AFTER INSERT OR UPDATE OR DELETE ON vendedor
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar tipo de operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: cod_ven=' || :NEW.cod_ven || ', nom_ven=' || :NEW.nom_ven || ', ape_ven=' || :NEW.ape_ven;
  
  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: cod_ven=' || :OLD.cod_ven || ', sue_ven=' || :OLD.sue_ven ||
                 ' -> NUEVO: sue_ven=' || :NEW.sue_ven;
  
  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: cod_ven=' || :OLD.cod_ven || ', nom_ven=' || :OLD.nom_ven || ', ape_ven=' || :OLD.ape_ven;
  END IF;

  -- Insertar en auditoria
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('VENDEDOR', v_operacion, USER, v_detalle);
END;






CREATE OR REPLACE TRIGGER trg_aud_cliente
AFTER INSERT OR UPDATE OR DELETE ON cliente
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar tipo de operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: cod_cli=' || :NEW.cod_cli || ', rso_cli=' || :NEW.rso_cli || ', tip_cli=' || :NEW.tip_cli;

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: cod_cli=' || :OLD.cod_cli || ', tip_cli=' || :OLD.tip_cli ||
                 ' -> NUEVO: tip_cli=' || :NEW.tip_cli;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: cod_cli=' || :OLD.cod_cli || ', rso_cli=' || :OLD.rso_cli || ', tip_cli=' || :OLD.tip_cli;
  END IF;

  -- Insertar en tabla de auditoría
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('CLIENTE', v_operacion, USER, v_detalle);
END;







CREATE OR REPLACE TRIGGER trg_aud_detalle_factura
AFTER INSERT OR UPDATE OR DELETE ON detalle_factura
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar tipo de operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: num_fac=' || :NEW.num_fac || ', cod_pro=' || :NEW.cod_pro ||
                 ', can_ven=' || :NEW.can_ven || ', pre_ven=' || :NEW.pre_ven;

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: num_fac=' || :OLD.num_fac || ', cod_pro=' || :OLD.cod_pro || 
                 ', can_ven=' || :OLD.can_ven || ', pre_ven=' || :OLD.pre_ven ||
                 ' -> NUEVO: can_ven=' || :NEW.can_ven || ', pre_ven=' || :NEW.pre_ven;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: num_fac=' || :OLD.num_fac || ', cod_pro=' || :OLD.cod_pro ||
                 ', can_ven=' || :OLD.can_ven || ', pre_ven=' || :OLD.pre_ven;
  END IF;

  -- Insertar en auditoría
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('DETALLE_FACTURA', v_operacion, USER, v_detalle);
END;



CREATE OR REPLACE TRIGGER trg_aud_abastecimiento
AFTER INSERT OR UPDATE OR DELETE ON abastecimiento
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar tipo de operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: cod_prv=' || :NEW.cod_prv || ', cod_pro=' || :NEW.cod_pro ||
                 ', pre_aba=' || :NEW.pre_aba;

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: cod_prv=' || :OLD.cod_prv || ', cod_pro=' || :OLD.cod_pro ||
                 ', pre_aba=' || :OLD.pre_aba ||
                 ' -> NUEVO: pre_aba=' || :NEW.pre_aba;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: cod_prv=' || :OLD.cod_prv || ', cod_pro=' || :OLD.cod_pro ||
                 ', pre_aba=' || :OLD.pre_aba;
  END IF;

  -- Insertar en auditoría
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('ABASTECIMIENTO', v_operacion, USER, v_detalle);
END;




CREATE OR REPLACE TRIGGER trg_aud_distrito
AFTER INSERT OR UPDATE OR DELETE ON distrito
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar el tipo de operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: cod_dis=' || :NEW.cod_dis || ', nom_dis=' || :NEW.nom_dis;

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: cod_dis=' || :OLD.cod_dis || ', nom_dis=' || :OLD.nom_dis ||
                 ' -> NUEVO: nom_dis=' || :NEW.nom_dis;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: cod_dis=' || :OLD.cod_dis || ', nom_dis=' || :OLD.nom_dis;
  END IF;

  -- Insertar en la tabla de auditoría
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('DISTRITO', v_operacion, USER, v_detalle);
END;



CREATE OR REPLACE TRIGGER trg_aud_proveedor
AFTER INSERT OR UPDATE OR DELETE ON proveedor
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  -- Determinar tipo de operación
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: cod_prv=' || :NEW.cod_prv || ', rso_prv=' || :NEW.rso_prv || 
                 ', cod_dis=' || :NEW.cod_dis;

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: cod_prv=' || :OLD.cod_prv || ', cod_dis=' || :OLD.cod_dis || 
                 ' -> NUEVO: cod_dis=' || :NEW.cod_dis;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: cod_prv=' || :OLD.cod_prv || ', rso_prv=' || :OLD.rso_prv || 
                 ', cod_dis=' || :OLD.cod_dis;
  END IF;

  -- Insertar en la tabla de auditoría
  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('PROVEEDOR', v_operacion, USER, v_detalle);
END;





CREATE OR REPLACE TRIGGER trg_aud_detalle_compra
AFTER INSERT OR UPDATE OR DELETE ON detalle_compra
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: num_oco=' || :NEW.num_oco || ', cod_pro=' || :NEW.cod_pro || 
                 ', can_det=' || :NEW.can_det;

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: num_oco=' || :OLD.num_oco || ', cod_pro=' || :OLD.cod_pro || 
                 ', can_det=' || :OLD.can_det ||
                 ' -> NUEVO: can_det=' || :NEW.can_det;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: num_oco=' || :OLD.num_oco || ', cod_pro=' || :OLD.cod_pro || 
                 ', can_det=' || :OLD.can_det;
  END IF;

  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('DETALLE_COMPRA', v_operacion, USER, v_detalle);
END;



CREATE OR REPLACE TRIGGER trg_aud_detalle_compra
AFTER INSERT OR UPDATE OR DELETE ON detalle_compra
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: num_oco=' || :NEW.num_oco || ', cod_pro=' || :NEW.cod_pro || 
                 ', can_det=' || :NEW.can_det;

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: num_oco=' || :OLD.num_oco || ', cod_pro=' || :OLD.cod_pro || 
                 ', can_det=' || :OLD.can_det ||
                 ' -> NUEVO: can_det=' || :NEW.can_det;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: num_oco=' || :OLD.num_oco || ', cod_pro=' || :OLD.cod_pro || 
                 ', can_det=' || :OLD.can_det;
  END IF;

  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('DETALLE_COMPRA', v_operacion, USER, v_detalle);
END;


CREATE OR REPLACE TRIGGER trg_aud_orden_compra
AFTER INSERT OR UPDATE OR DELETE ON orden_compra
FOR EACH ROW
DECLARE
  v_operacion VARCHAR2(10);
  v_detalle   CLOB;
BEGIN
  IF INSERTING THEN
    v_operacion := 'INSERT';
    v_detalle := 'NUEVO: num_oco=' || :NEW.num_oco || ', cod_prv=' || :NEW.cod_prv || 
                 ', fec_oco=' || TO_CHAR(:NEW.fec_oco, 'YYYY-MM-DD');

  ELSIF UPDATING THEN
    v_operacion := 'UPDATE';
    v_detalle := 'ANTES: num_oco=' || :OLD.num_oco || ', est_oco=' || :OLD.est_oco ||
                 ' -> NUEVO: est_oco=' || :NEW.est_oco;

  ELSIF DELETING THEN
    v_operacion := 'DELETE';
    v_detalle := 'ELIMINADO: num_oco=' || :OLD.num_oco || ', cod_prv=' || :OLD.cod_prv;
  END IF;

  INSERT INTO auditoria(nombre_tabla, tipo_operacion, usuario_bdd, detalle)
  VALUES ('ORDEN_COMPRA', v_operacion, USER, v_detalle);
END;
/

DELETE FROM DETALLE_COMPRA;






/*TABLAS */
SELECT * FROM CLIENTE;
SELECT * FROM PROVEEDOR;
SELECT * FROM FACTURA;
SELECT * FROM ORDEN_COMPRA;
SELECT * FROM PRODUCTO;
SELECT * FROM DETALLE_FACTURA;
SELECT * FROM DETALLE_COMPRA;
SELECT * FROM VENDEDOR;
SELECT * FROM DISTRITO;
SELECT * FROM ABASTECIMIENTO;
SELECT cod_pro FROM producto ORDER BY cod_pro;




/*AUDITORIAS*/
SELECT * FROM auditoria ;
SELECT * FROM auditoria WHERE nombre_tabla = 'FACTURA' ORDER BY fecha_operacion DESC;
SELECT * FROM auditoria WHERE nombre_tabla = 'PRODUCTO' ORDER BY fecha_operacion DESC;
SELECT * FROM auditoria WHERE nombre_tabla = 'VENDEDOR' ORDER BY fecha_operacion DESC
SELECT * FROM auditoria WHERE nombre_tabla = 'CLIENTE' ORDER BY fecha_operacion DESC;
SELECT * FROM auditoria WHERE nombre_tabla = 'DETALLE_FACTURA' ORDER BY fecha_operacion DESC;

SELECT * FROM auditoria WHERE nombre_tabla = 'DISTRITO' ORDER BY fecha_operacion DESC;
SELECT * FROM auditoria WHERE nombre_tabla = 'PROVEEDOR' ORDER BY fecha_operacion DESC;
SELECT * FROM auditoria WHERE nombre_tabla = 'ORDEN_COMPRA' ORDER BY fecha_operacion DESC;
SELECT * FROM auditoria WHERE nombre_tabla = 'DETALLE_COMPRA' ORDER BY fecha_operacion DESC;

SELECT * FROM auditoria WHERE nombre_tabla = 'ABASTECIMIENTO' ORDER BY fecha_operacion DESC;


/*1. Reporte de la tabla auditoría por fecha de los cambios realizados.*/
SELECT 
    id_audit,
    nombre_tabla,
    tipo_operacion,
    usuario_bdd,
    TO_CHAR(fecha_operacion, 'YYYY-MM-DD HH24:MI:SS') AS fecha_operacion,
    detalle
FROM auditoria
ORDER BY fecha_operacion DESC;




/*
2. Reporte de los 3 empleados con ventas más bajas, indicar el empleado y el valor de las ventas. 
 */
 
 
 SELECT 
    v.cod_ven,
    v.nom_ven || ' ' || v.ape_ven AS vendedor,
    SUM(df.can_ven * df.pre_ven) AS total_ventas
FROM vendedor v
JOIN factura f ON v.cod_ven = f.cod_ven
JOIN detalle_factura df ON f.num_fac = df.num_fac
GROUP BY v.cod_ven, v.nom_ven, v.ape_ven
ORDER BY total_ventas ASC
FETCH FIRST 3 ROWS ONLY;



